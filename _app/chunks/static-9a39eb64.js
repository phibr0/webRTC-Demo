import{S as O,i as V,s as q,k as M,f as S,d as u,e as g,j as D,t as T,c as b,a as w,l as I,g as j,b as y,H as _,J as P,K as L,I as E,L as le,M as G,u as H,N as U,h as B,O as J,Q as ae,P as z,R as W,T as re,U as X,V as oe,p as N,n as R,m as ie,o as ce,v as Z,w as Y,x,A as ee,W as ue}from"./vendor-f6322723.js";function te(a,e,t){const s=a.slice();return s[5]=e[t],s}function fe(a){let e,t,s=a[5].data+"",l,n;return{c(){e=g("div"),t=g("span"),l=T(s),this.h()},l(r){e=b(r,"DIV",{class:!0});var c=w(e);t=b(c,"SPAN",{});var h=w(t);l=j(h,s),h.forEach(u),c.forEach(u),this.h()},h(){y(e,"class",n=""+(U(a[5].type)+" svelte-1jfuv91"))},m(r,c){S(r,e,c),_(e,t),_(t,l)},p(r,c){c&1&&s!==(s=r[5].data+"")&&B(l,s),c&1&&n!==(n=""+(U(r[5].type)+" svelte-1jfuv91"))&&y(e,"class",n)},d(r){r&&u(e)}}}function he(a){let e,t,s=a[5].data+"",l,n;return{c(){e=g("div"),t=g("span"),l=T(s),this.h()},l(r){e=b(r,"DIV",{class:!0});var c=w(e);t=b(c,"SPAN",{});var h=w(t);l=j(h,s),h.forEach(u),c.forEach(u),this.h()},h(){y(e,"class",n=""+(U(a[5].type)+" svelte-1jfuv91"))},m(r,c){S(r,e,c),_(e,t),_(t,l)},p(r,c){c&1&&s!==(s=r[5].data+"")&&B(l,s),c&1&&n!==(n=""+(U(r[5].type)+" svelte-1jfuv91"))&&y(e,"class",n)},d(r){r&&u(e)}}}function ne(a){let e;function t(n,r){return n[5].type==="incoming"?he:fe}let s=t(a),l=s(a);return{c(){l.c(),e=M()},l(n){l.l(n),e=M()},m(n,r){l.m(n,r),S(n,e,r)},p(n,r){s===(s=t(n))&&l?l.p(n,r):(l.d(1),l=s(n),l&&(l.c(),l.m(e.parentNode,e)))},d(n){l.d(n),n&&u(e)}}}function de(a){let e,t,s,l,n,r,c,h,o,f,m=a[0],d=[];for(let i=0;i<m.length;i+=1)d[i]=ne(te(a,m,i));return{c(){e=g("main"),t=g("div");for(let i=0;i<d.length;i+=1)d[i].c();s=D(),l=g("div"),n=g("input"),r=D(),c=g("div"),h=T("Send"),this.h()},l(i){e=b(i,"MAIN",{class:!0});var p=w(e);t=b(p,"DIV",{class:!0});var v=w(t);for(let A=0;A<d.length;A+=1)d[A].l(v);v.forEach(u),s=I(p),l=b(p,"DIV",{class:!0});var k=w(l);n=b(k,"INPUT",{type:!0,class:!0}),r=I(k),c=b(k,"DIV",{class:!0});var C=w(c);h=j(C,"Send"),C.forEach(u),k.forEach(u),p.forEach(u),this.h()},h(){y(t,"class","messages svelte-1jfuv91"),y(n,"type","text"),y(n,"class","svelte-1jfuv91"),y(c,"class","btn svelte-1jfuv91"),y(l,"class","input svelte-1jfuv91"),y(e,"class","svelte-1jfuv91")},m(i,p){S(i,e,p),_(e,t);for(let v=0;v<d.length;v+=1)d[v].m(t,null);_(e,s),_(e,l),_(l,n),P(n,a[1]),_(l,r),_(l,c),_(c,h),o||(f=[L(n,"input",a[4]),L(c,"click",a[2])],o=!0)},p(i,[p]){if(p&1){m=i[0];let v;for(v=0;v<m.length;v+=1){const k=te(i,m,v);d[v]?d[v].p(k,p):(d[v]=ne(k),d[v].c(),d[v].m(t,null))}for(;v<d.length;v+=1)d[v].d(1);d.length=m.length}p&2&&n.value!==i[1]&&P(n,i[1])},i:E,o:E,d(i){i&&u(e),le(d,i),o=!1,G(f)}}}function pe(a,e,t){let{channel:s}=e,l=[],n="";H(()=>t(3,s.onmessage=({data:h})=>t(0,l=[...l,{type:"incoming",data:h}]),s));function r(){n&&(t(0,l=[...l,{type:"outgoing",data:n}]),s.send(n),t(1,n=""))}function c(){n=this.value,t(1,n)}return a.$$set=h=>{"channel"in h&&t(3,s=h.channel)},[l,n,r,s,c]}class Te extends O{constructor(e){super();V(this,e,pe,de,q,{channel:3})}}var F=globalThis&&globalThis.__awaiter||function(a,e,t,s){function l(n){return n instanceof t?n:new t(function(r){r(n)})}return new(t||(t=Promise))(function(n,r){function c(f){try{o(s.next(f))}catch(m){r(m)}}function h(f){try{o(s.throw(f))}catch(m){r(m)}}function o(f){f.done?n(f.value):l(f.value).then(c,h)}o((s=s.apply(a,e||[])).next())})},Q=globalThis&&globalThis.__generator||function(a,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,l,n,r;return r={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function c(o){return function(f){return h([o,f])}}function h(o){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,l&&(n=o[0]&2?l.return:o[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,o[1])).done)return n;switch(l=0,n&&(o=[o[0]&2,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return t.label++,{value:o[1],done:!1};case 5:t.label++,l=o[1],o=[0];continue;case 7:o=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){t=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){t.label=o[1];break}if(o[0]===6&&t.label<n[1]){t.label=n[1],n=o;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(o);break}n[2]&&t.ops.pop(),t.trys.pop();continue}o=e.call(a,t)}catch(f){o=[6,f],l=0}finally{s=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},ve=function(){function a(e,t,s){var l=this;s===void 0&&(s=!1),this.localConnection=new RTCPeerConnection(e),this.debug=s,t==="offer"?(this.channel=this.localConnection.createDataChannel("channel"),this.setupChannel()):this.localConnection.ondatachannel=function(n){l.channel=n.channel,l.setupChannel()},this.localConnection.onicecandidate=function(){l.sdp=l.localConnection.localDescription}}return a.prototype.setupChannel=function(){var e=this;this.channel.onmessage=function(t){var s;(s=e.onMessage)===null||s===void 0||s.call(e,t.data),e.log("Received message.")},this.channel.onopen=function(){var t;(t=e.onOpen)===null||t===void 0||t.call(e),e.log("Channel opened.")},this.channel.onclose=function(){var t;(t=e.onClose)===null||t===void 0||t.call(e),e.log("Received closed.")}},a.prototype.generateOffer=function(e){return F(this,void 0,void 0,function(){var t=this;return Q(this,function(s){switch(s.label){case 0:return[4,this.localConnection.createOffer().then(function(l){return t.localConnection.setLocalDescription(l)})];case 1:return s.sent(),[4,this.delay(e)];case 2:return s.sent(),[2,this.sdp]}})})},a.prototype.generateAnswer=function(e){return F(this,void 0,void 0,function(){var t=this;return Q(this,function(s){switch(s.label){case 0:return[4,this.localConnection.createAnswer().then(function(l){return t.localConnection.setLocalDescription(l)})];case 1:return s.sent(),[4,this.delay(e)];case 2:return s.sent(),[2,this.sdp]}})})},a.prototype.setRemoteDescription=function(e){return F(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.localConnection.setRemoteDescription(e)];case 1:return t.sent(),[2]}})})},a.isValidSessionDescription=function(e){return!!e.match(/(?:^[a-z]=.*$|\n)+/gm)},a.prototype.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},a.prototype.log=function(e){this.debug&&console.log(e)},a}();function _e(a){let e,t,s,l,n,r,c,h,o,f,m,d,i,p,v;return{c(){e=g("main"),t=g("p"),s=T("Scan the QRCode of the other client,"),l=D(),n=g("video"),r=D(),c=g("p"),h=T("Or paste the key:"),o=D(),f=g("textarea"),m=D(),d=g("button"),i=T("Start"),this.h()},l(k){e=b(k,"MAIN",{class:!0});var C=w(e);t=b(C,"P",{class:!0});var A=w(t);s=j(A,"Scan the QRCode of the other client,"),A.forEach(u),l=I(C),n=b(C,"VIDEO",{class:!0}),w(n).forEach(u),r=I(C),c=b(C,"P",{class:!0});var $=w(c);h=j($,"Or paste the key:"),$.forEach(u),o=I(C),f=b(C,"TEXTAREA",{class:!0}),w(f).forEach(u),m=I(C),d=b(C,"BUTTON",{});var K=w(d);i=j(K,"Start"),K.forEach(u),C.forEach(u),this.h()},h(){y(t,"class","svelte-146gwr"),n.autoplay=!0,y(n,"class","svelte-146gwr"),y(c,"class","svelte-146gwr"),y(f,"class","svelte-146gwr"),J(f,"invalid",a[2]),y(e,"class","svelte-146gwr")},m(k,C){S(k,e,C),_(e,t),_(t,s),_(e,l),_(e,n),a[3](n),_(e,r),_(e,c),_(c,h),_(e,o),_(e,f),P(f,a[0]),_(e,m),_(e,d),_(d,i),p||(v=[L(f,"input",a[4]),L(d,"click",a[5])],p=!0)},p(k,[C]){C&1&&P(f,k[0]),C&4&&J(f,"invalid",k[2])},i:E,o:E,d(k){k&&u(e),a[3](null),p=!1,G(v)}}}function me(a,e,t){let s,l="",n;H(()=>{navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then(o=>{t(1,s.srcObject=o,s),new ae().decodeFromVideo(s).then(m=>{dispatchEvent(new CustomEvent("scan",{detail:{data:m.data}}))})}).catch(o=>{console.error(o)})});function r(o){W[o?"unshift":"push"](()=>{s=o,t(1,s)})}function c(){l=this.value,t(0,l)}const h=()=>dispatchEvent(new CustomEvent("scan",{detail:{data:z.decompressFromBase64(l)}}));return a.$$.update=()=>{a.$$.dirty&1&&(l.length?t(2,n=!ve.isValidSessionDescription(z.decompressFromBase64(l))):t(2,n=!1))},[l,s,n,r,c,h]}class Ie extends O{constructor(e){super();V(this,e,me,_e,q,{})}}function ge(a){let e;return{c(){e=g("canvas"),this.h()},l(t){e=b(t,"CANVAS",{class:!0}),w(e).forEach(u),this.h()},h(){y(e,"class","svelte-ewlrv4")},m(t,s){S(t,e,s),a[2](e)},p:E,i:E,o:E,d(t){t&&u(e),a[2](null)}}}function be(a,e,t){let{data:s}=e,l;function n(r){W[r?"unshift":"push"](()=>{l=r,t(0,l)})}return a.$$set=r=>{"data"in r&&t(1,s=r.data)},a.$$.update=()=>{a.$$.dirty&3&&s&&re.toCanvas(l,s,{margin:2,errorCorrectionLevel:"low"})},[l,s,n]}class ye extends O{constructor(e){super();V(this,e,be,ge,q,{data:1})}}function se(a){let e,t,s,l={ctx:a,current:null,token:null,hasCatch:!1,pending:Ce,then:we,catch:ke,value:1,blocks:[,,,]};return X(t=a[0],l),{c(){e=M(),l.block.c()},l(n){e=M(),l.block.l(n)},m(n,r){S(n,e,r),l.block.m(n,l.anchor=r),l.mount=()=>e.parentNode,l.anchor=e,s=!0},p(n,r){a=n,l.ctx=a,r&1&&t!==(t=a[0])&&X(t,l)||oe(l,a,r)},i(n){s||(N(l.block),s=!0)},o(n){for(let r=0;r<3;r+=1){const c=l.blocks[r];R(c)}s=!1},d(n){n&&u(e),l.block.d(n),l.token=null,l=null}}}function ke(a){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function we(a){let e,t,s,l,n,r,c,h,o,f=z.compressToBase64(a[1].sdp)+"",m,d;return l=new ye({props:{data:a[1].sdp}}),{c(){e=g("p"),t=T("Let the other User scan this Code:"),s=D(),Z(l.$$.fragment),n=D(),r=g("p"),c=T("or share the following Key:"),h=D(),o=g("code"),m=T(f),this.h()},l(i){e=b(i,"P",{class:!0});var p=w(e);t=j(p,"Let the other User scan this Code:"),p.forEach(u),s=I(i),Y(l.$$.fragment,i),n=I(i),r=b(i,"P",{class:!0});var v=w(r);c=j(v,"or share the following Key:"),v.forEach(u),h=I(i),o=b(i,"CODE",{class:!0});var k=w(o);m=j(k,f),k.forEach(u),this.h()},h(){y(e,"class","svelte-7zcqgs"),y(r,"class","svelte-7zcqgs"),y(o,"class","svelte-7zcqgs")},m(i,p){S(i,e,p),_(e,t),S(i,s,p),x(l,i,p),S(i,n,p),S(i,r,p),_(r,c),S(i,h,p),S(i,o,p),_(o,m),d=!0},p(i,p){const v={};p&1&&(v.data=i[1].sdp),l.$set(v),(!d||p&1)&&f!==(f=z.compressToBase64(i[1].sdp)+"")&&B(m,f)},i(i){d||(N(l.$$.fragment,i),d=!0)},o(i){R(l.$$.fragment,i),d=!1},d(i){i&&u(e),i&&u(s),ee(l,i),i&&u(n),i&&u(r),i&&u(h),i&&u(o)}}}function Ce(a){let e,t;return e=new ue({props:{color:"#fff"}}),{c(){Z(e.$$.fragment)},l(s){Y(e.$$.fragment,s)},m(s,l){x(e,s,l),t=!0},p:E,i(s){t||(N(e.$$.fragment,s),t=!0)},o(s){R(e.$$.fragment,s),t=!1},d(s){ee(e,s)}}}function Ee(a){let e,t,s=a[0]&&se(a);return{c(){e=g("main"),s&&s.c(),this.h()},l(l){e=b(l,"MAIN",{class:!0});var n=w(e);s&&s.l(n),n.forEach(u),this.h()},h(){y(e,"class","svelte-7zcqgs")},m(l,n){S(l,e,n),s&&s.m(e,null),t=!0},p(l,[n]){l[0]?s?(s.p(l,n),n&1&&N(s,1)):(s=se(l),s.c(),N(s,1),s.m(e,null)):s&&(ie(),R(s,1,1,()=>{s=null}),ce())},i(l){t||(N(s),t=!0)},o(l){R(s),t=!1},d(l){l&&u(e),s&&s.d()}}}function Se(a,e,t){let{sdp:s}=e;return a.$$set=l=>{"sdp"in l&&t(0,s=l.sdp)},[s]}class je extends O{constructor(e){super();V(this,e,Se,Ee,q,{sdp:0})}}const Ae={iceServers:[{urls:"stun:stun1.l.google.com:19302"}]};export{Te as C,Ae as I,ve as R,je as S,Ie as a};

import{S,i as T,s as R,k as q,f as E,d,e as _,j as L,t as N,c as p,a as C,l as P,g as V,b as m,H as g,L as Q,M as j,I as w,N as z,O as B,u as F,P as D,h as G,Q as J,R as U,T as K}from"./vendor-12ffae65.js";function H(l,t,e){const s=l.slice();return s[5]=t[e],s}function W(l){let t,e,s=l[5].data+"",a,n;return{c(){t=_("div"),e=_("span"),a=N(s),this.h()},l(i){t=p(i,"DIV",{class:!0});var c=C(t);e=p(c,"SPAN",{});var h=C(e);a=V(h,s),h.forEach(d),c.forEach(d),this.h()},h(){m(t,"class",n=""+(D(l[5].type)+" svelte-16ca9vt"))},m(i,c){E(i,t,c),g(t,e),g(e,a)},p(i,c){c&1&&s!==(s=i[5].data+"")&&G(a,s),c&1&&n!==(n=""+(D(i[5].type)+" svelte-16ca9vt"))&&m(t,"class",n)},d(i){i&&d(t)}}}function X(l){let t,e,s=l[5].data+"",a,n;return{c(){t=_("div"),e=_("span"),a=N(s),this.h()},l(i){t=p(i,"DIV",{class:!0});var c=C(t);e=p(c,"SPAN",{});var h=C(e);a=V(h,s),h.forEach(d),c.forEach(d),this.h()},h(){m(t,"class",n=""+(D(l[5].type)+" svelte-16ca9vt"))},m(i,c){E(i,t,c),g(t,e),g(e,a)},p(i,c){c&1&&s!==(s=i[5].data+"")&&G(a,s),c&1&&n!==(n=""+(D(i[5].type)+" svelte-16ca9vt"))&&m(t,"class",n)},d(i){i&&d(t)}}}function x(l){let t;function e(n,i){return n[5].type==="incoming"?X:W}let s=e(l),a=s(l);return{c(){a.c(),t=q()},l(n){a.l(n),t=q()},m(n,i){a.m(n,i),E(n,t,i)},p(n,i){s===(s=e(n))&&a?a.p(n,i):(a.d(1),a=s(n),a&&(a.c(),a.m(t.parentNode,t)))},d(n){a.d(n),n&&d(t)}}}function Y(l){let t,e,s,a,n,i,c,h,o,v,y=l[0],f=[];for(let r=0;r<y.length;r+=1)f[r]=x(H(l,y,r));return{c(){t=_("main"),e=_("div");for(let r=0;r<f.length;r+=1)f[r].c();s=L(),a=_("div"),n=_("input"),i=L(),c=_("div"),h=N("Send"),this.h()},l(r){t=p(r,"MAIN",{class:!0});var b=C(t);e=p(b,"DIV",{class:!0});var u=C(e);for(let I=0;I<f.length;I+=1)f[I].l(u);u.forEach(d),s=P(b),a=p(b,"DIV",{class:!0});var k=C(a);n=p(k,"INPUT",{type:!0,class:!0}),i=P(k),c=p(k,"DIV",{class:!0});var O=C(c);h=V(O,"Send"),O.forEach(d),k.forEach(d),b.forEach(d),this.h()},h(){m(e,"class","messages svelte-16ca9vt"),m(n,"type","text"),m(n,"class","svelte-16ca9vt"),m(c,"class","btn svelte-16ca9vt"),m(a,"class","input svelte-16ca9vt"),m(t,"class","svelte-16ca9vt")},m(r,b){E(r,t,b),g(t,e);for(let u=0;u<f.length;u+=1)f[u].m(e,null);g(t,s),g(t,a),g(a,n),Q(n,l[1]),g(a,i),g(a,c),g(c,h),o||(v=[j(n,"input",l[4]),j(c,"click",l[2])],o=!0)},p(r,[b]){if(b&1){y=r[0];let u;for(u=0;u<y.length;u+=1){const k=H(r,y,u);f[u]?f[u].p(k,b):(f[u]=x(k),f[u].c(),f[u].m(e,null))}for(;u<f.length;u+=1)f[u].d(1);f.length=y.length}b&2&&n.value!==r[1]&&Q(n,r[1])},i:w,o:w,d(r){r&&d(t),z(f,r),o=!1,B(v)}}}function Z(l,t,e){let{channel:s}=t,a=[],n="";F(()=>e(3,s.onmessage=({data:h})=>e(0,a=[...a,{type:"incoming",data:h}]),s));function i(){n&&(e(0,a=[...a,{type:"outgoing",data:n}]),s.send(n),e(1,n=""))}function c(){n=this.value,e(1,n)}return l.$$set=h=>{"channel"in h&&e(3,s=h.channel)},[a,n,i,s,c]}class ae extends S{constructor(t){super();T(this,t,Z,Y,R,{channel:3})}}function $(l){let t;return{c(){t=_("video"),this.h()},l(e){t=p(e,"VIDEO",{}),C(t).forEach(d),this.h()},h(){t.autoplay=!0},m(e,s){E(e,t,s),l[1](t)},p:w,i:w,o:w,d(e){e&&d(t),l[1](null)}}}function ee(l,t,e){let s;F(()=>{navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then(n=>{e(0,s.srcObject=n,s),new J().decodeFromVideo(s).then(c=>{dispatchEvent(new CustomEvent("scan",{detail:{data:c.data}}))})}).catch(n=>{console.error(n)})});function a(n){U[n?"unshift":"push"](()=>{s=n,e(0,s)})}return[s,a]}class ie extends S{constructor(t){super();T(this,t,ee,$,R,{})}}function te(l){let t;return{c(){t=_("canvas"),this.h()},l(e){t=p(e,"CANVAS",{class:!0}),C(t).forEach(d),this.h()},h(){m(t,"class","svelte-ewlrv4")},m(e,s){E(e,t,s),l[2](t)},p:w,i:w,o:w,d(e){e&&d(t),l[2](null)}}}function ne(l,t,e){let{data:s}=t,a;function n(i){U[i?"unshift":"push"](()=>{a=i,e(0,a)})}return l.$$set=i=>{"data"in i&&e(1,s=i.data)},l.$$.update=()=>{l.$$.dirty&3&&s&&K.toCanvas(a,s,{margin:2,errorCorrectionLevel:"low"})},[a,s,n]}class le extends S{constructor(t){super();T(this,t,ne,te,R,{data:1})}}var A=globalThis&&globalThis.__awaiter||function(l,t,e,s){function a(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function c(v){try{o(s.next(v))}catch(y){i(y)}}function h(v){try{o(s.throw(v))}catch(y){i(y)}}function o(v){v.done?n(v.value):a(v.value).then(c,h)}o((s=s.apply(l,t||[])).next())})},M=globalThis&&globalThis.__generator||function(l,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,a,n,i;return i={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(o){return function(v){return h([o,v])}}function h(o){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,a&&(n=o[0]&2?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[o[0]&2,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,a=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){e.label=o[1];break}if(o[0]===6&&e.label<n[1]){e.label=n[1],n=o;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(o);break}n[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(l,e)}catch(v){o=[6,v],a=0}finally{s=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},oe=function(){function l(t,e,s){var a=this;s===void 0&&(s=!1),this.localConnection=new RTCPeerConnection(t),this.debug=s,e==="offer"?(this.channel=this.localConnection.createDataChannel("channel"),this.setupChannel()):this.localConnection.ondatachannel=function(n){a.channel=n.channel,a.setupChannel()},this.localConnection.onicecandidate=function(){a.sdp=a.localConnection.localDescription}}return l.prototype.setupChannel=function(){var t=this;this.channel.onmessage=function(e){var s;(s=t.onMessage)===null||s===void 0||s.call(t,e.data),t.log("Received message.")},this.channel.onopen=function(){var e;(e=t.onOpen)===null||e===void 0||e.call(t),t.log("Channel opened.")},this.channel.onclose=function(){var e;(e=t.onClose)===null||e===void 0||e.call(t),t.log("Received closed.")}},l.prototype.generateOffer=function(t){return A(this,void 0,void 0,function(){var e=this;return M(this,function(s){switch(s.label){case 0:return[4,this.localConnection.createOffer().then(function(a){return e.localConnection.setLocalDescription(a)})];case 1:return s.sent(),[4,this.delay(t)];case 2:return s.sent(),[2,this.sdp]}})})},l.prototype.generateAnswer=function(t){return A(this,void 0,void 0,function(){var e=this;return M(this,function(s){switch(s.label){case 0:return[4,this.localConnection.createAnswer().then(function(a){return e.localConnection.setLocalDescription(a)})];case 1:return s.sent(),[4,this.delay(t)];case 2:return s.sent(),[2,this.sdp]}})})},l.prototype.setRemoteDescription=function(t){return A(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return[4,this.localConnection.setRemoteDescription(t)];case 1:return e.sent(),[2]}})})},l.prototype.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},l.prototype.log=function(t){this.debug&&console.log(t)},l}();const ce={iceServers:[{urls:"stun:stun1.l.google.com:19302"}]};export{ae as C,ce as I,le as Q,oe as R,ie as S};

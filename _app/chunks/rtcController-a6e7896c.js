import{S,i as k,s as N,k as R,f as E,d as u,e as f,j as P,t as O,c as p,a as g,l as T,g as V,b as _,H as v,L as j,M as q,I as y,N as G,O as H,u as L,P as D,h as Q,Q as J,R as U,T as B,U as K}from"./vendor-0fb0a8b3.js";/* empty css                                           */function F(o,e,t){const l=o.slice();return l[5]=e[t],l}function W(o){let e,t,l=o[5].data+"",n,s;return{c(){e=f("div"),t=f("span"),n=O(l),this.h()},l(a){e=p(a,"DIV",{class:!0});var c=g(e);t=p(c,"SPAN",{});var h=g(t);n=V(h,l),h.forEach(u),c.forEach(u),this.h()},h(){_(e,"class",s=""+(D(o[5].type)+" svelte-16ca9vt"))},m(a,c){E(a,e,c),v(e,t),v(t,n)},p(a,c){c&1&&l!==(l=a[5].data+"")&&Q(n,l),c&1&&s!==(s=""+(D(a[5].type)+" svelte-16ca9vt"))&&_(e,"class",s)},d(a){a&&u(e)}}}function X(o){let e,t,l=o[5].data+"",n,s;return{c(){e=f("div"),t=f("span"),n=O(l),this.h()},l(a){e=p(a,"DIV",{class:!0});var c=g(e);t=p(c,"SPAN",{});var h=g(t);n=V(h,l),h.forEach(u),c.forEach(u),this.h()},h(){_(e,"class",s=""+(D(o[5].type)+" svelte-16ca9vt"))},m(a,c){E(a,e,c),v(e,t),v(t,n)},p(a,c){c&1&&l!==(l=a[5].data+"")&&Q(n,l),c&1&&s!==(s=""+(D(a[5].type)+" svelte-16ca9vt"))&&_(e,"class",s)},d(a){a&&u(e)}}}function z(o){let e;function t(s,a){return s[5].type==="incoming"?X:W}let l=t(o),n=l(o);return{c(){n.c(),e=R()},l(s){n.l(s),e=R()},m(s,a){n.m(s,a),E(s,e,a)},p(s,a){l===(l=t(s))&&n?n.p(s,a):(n.d(1),n=l(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){n.d(s),s&&u(e)}}}function Y(o){let e,t,l,n,s,a,c,h,w,A,b=o[0],d=[];for(let i=0;i<b.length;i+=1)d[i]=z(F(o,b,i));return{c(){e=f("main"),t=f("div");for(let i=0;i<d.length;i+=1)d[i].c();l=P(),n=f("div"),s=f("input"),a=P(),c=f("div"),h=O("Send"),this.h()},l(i){e=p(i,"MAIN",{class:!0});var m=g(e);t=p(m,"DIV",{class:!0});var r=g(t);for(let I=0;I<d.length;I+=1)d[I].l(r);r.forEach(u),l=T(m),n=p(m,"DIV",{class:!0});var C=g(n);s=p(C,"INPUT",{type:!0,class:!0}),a=T(C),c=p(C,"DIV",{class:!0});var M=g(c);h=V(M,"Send"),M.forEach(u),C.forEach(u),m.forEach(u),this.h()},h(){_(t,"class","messages svelte-16ca9vt"),_(s,"type","text"),_(s,"class","svelte-16ca9vt"),_(c,"class","btn svelte-16ca9vt"),_(n,"class","input svelte-16ca9vt"),_(e,"class","svelte-16ca9vt")},m(i,m){E(i,e,m),v(e,t);for(let r=0;r<d.length;r+=1)d[r].m(t,null);v(e,l),v(e,n),v(n,s),j(s,o[1]),v(n,a),v(n,c),v(c,h),w||(A=[q(s,"input",o[4]),q(c,"click",o[2])],w=!0)},p(i,[m]){if(m&1){b=i[0];let r;for(r=0;r<b.length;r+=1){const C=F(i,b,r);d[r]?d[r].p(C,m):(d[r]=z(C),d[r].c(),d[r].m(t,null))}for(;r<d.length;r+=1)d[r].d(1);d.length=b.length}m&2&&s.value!==i[1]&&j(s,i[1])},i:y,o:y,d(i){i&&u(e),G(d,i),w=!1,H(A)}}}function Z(o,e,t){let{channel:l}=e,n=[],s="";L(()=>t(3,l.onmessage=({data:h})=>t(0,n=[...n,{type:"incoming",data:h}]),l));function a(){s&&(t(0,n=[...n,{type:"outgoing",data:s}]),l.send(s),t(1,s=""))}function c(){s=this.value,t(1,s)}return o.$$set=h=>{"channel"in h&&t(3,l=h.channel)},[n,s,a,l,c]}class le extends S{constructor(e){super();k(this,e,Z,Y,N,{channel:3})}}function x(o){let e;return{c(){e=f("video"),this.h()},l(t){e=p(t,"VIDEO",{}),g(e).forEach(u),this.h()},h(){e.autoplay=!0},m(t,l){E(t,e,l),o[2](e)},p:y,i:y,o:y,d(t){t&&u(e),o[2](null)}}}function $(o,e,t){let{type:l}=e,n;L(()=>{navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then(a=>{t(0,n.srcObject=a,n),new J().decodeFromVideo(n).then(h=>{dispatchEvent(new CustomEvent("scan",{detail:{sdp:{sdp:h.data,type:l}}})),console.log(JSON.parse(h.data))})}).catch(a=>{console.error(a)})});function s(a){U[a?"unshift":"push"](()=>{n=a,t(0,n)})}return o.$$set=a=>{"type"in a&&t(1,l=a.type)},[n,l,s]}class oe extends S{constructor(e){super();k(this,e,$,x,N,{type:1})}}function ee(o){let e;return{c(){e=f("canvas"),this.h()},l(t){e=p(t,"CANVAS",{class:!0}),g(e).forEach(u),this.h()},h(){_(e,"class","svelte-ewlrv4")},m(t,l){E(t,e,l),o[2](e)},p:y,i:y,o:y,d(t){t&&u(e),o[2](null)}}}function te(o,e,t){let{data:l}=e,n;function s(a){U[a?"unshift":"push"](()=>{n=a,t(0,n)})}return o.$$set=a=>{"data"in a&&t(1,l=a.data)},o.$$.update=()=>{o.$$.dirty&3&&l&&(B.toCanvas(n,l,{margin:2,errorCorrectionLevel:"low"}),console.log(K.exports.compressToEncodedURIComponent(l)))},[n,l,s]}class ce extends S{constructor(e){super();k(this,e,te,ee,N,{data:1})}}const ne={iceServers:[{urls:"stun:stun1.l.google.com:19302"}]};class ie{constructor(e){this.localConnection=new RTCPeerConnection(ne),e==="offer"?this.channel=this.localConnection.createDataChannel("channel"):this.localConnection.ondatachannel=t=>this.channel=t.channel,this.setup()}setup(){this.localConnection.onicecandidate=()=>{this.sdp=this.localConnection.localDescription.sdp},this.channel.onmessage=e=>{var t;return(t=this.onMessage)==null?void 0:t.call(this,e.data)},this.channel.onopen=()=>{var e;return(e=this.onOpen)==null?void 0:e.call(this)},this.channel.onclose=()=>{var e;return(e=this.onClose)==null?void 0:e.call(this)}}async generateOffer(e){return await this.localConnection.createOffer().then(t=>this.localConnection.setLocalDescription(t)),await this.delay(e),this.sdp}async generateAnswer(e){return await this.localConnection.createAnswer().then(t=>this.localConnection.setLocalDescription(t)),await this.delay(e),this.sdp}setRemoteDescription(e){this.localConnection.setRemoteDescription(e)}delay(e){return new Promise(t=>setTimeout(t,e))}}export{le as C,ce as Q,ie as R,oe as S};

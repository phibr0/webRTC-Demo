import{S as M,i as P,s as I,e as h,c as m,a as d,d as u,b as g,f as _,n as k,o as N,p as C,u as R,m as O,J as T,K as U,v as y,w,x as S,A as D,I as v,t as $,j as E,g as L,l as j,H as A,M as q}from"../chunks/vendor-efad3a29.js";import{C as H,S as J}from"../chunks/scanner-64a81939.js";/* empty css                                                   */function K(i){let t,n;return t=new H({props:{channel:i[1]}}),{c(){y(t.$$.fragment)},l(e){w(t.$$.fragment,e)},m(e,o){S(t,e,o),n=!0},p(e,o){const l={};o&2&&(l.channel=e[1]),t.$set(l)},i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){k(t.$$.fragment,e),n=!1},d(e){D(t,e)}}}function V(i){let t,n;return t=new J({props:{type:"answer"}}),{c(){y(t.$$.fragment)},l(e){w(t.$$.fragment,e)},m(e,o){S(t,e,o),n=!0},p:v,i(e){n||(C(t.$$.fragment,e),n=!0)},o(e){k(t.$$.fragment,e),n=!1},d(e){D(t,e)}}}function x(i){let t,n,e,o,l,r,p,a,c;return{c(){t=h("p"),n=$("Let the other User scan this Code"),e=E(),o=h("canvas"),l=E(),r=h("p"),p=$("Done"),this.h()},l(s){t=m(s,"P",{class:!0});var f=d(t);n=L(f,"Let the other User scan this Code"),f.forEach(u),e=j(s),o=m(s,"CANVAS",{class:!0}),d(o).forEach(u),l=j(s),r=m(s,"P",{class:!0});var b=d(r);p=L(b,"Done"),b.forEach(u),this.h()},h(){g(t,"class","svelte-1kwy305"),g(o,"class","svelte-1kwy305"),g(r,"class","btn svelte-1kwy305")},m(s,f){_(s,t,f),A(t,n),_(s,e,f),_(s,o,f),i[3](o),_(s,l,f),_(s,r,f),A(r,p),a||(c=q(r,"click",i[4]),a=!0)},p:v,i:v,o:v,d(s){s&&u(t),s&&u(e),s&&u(o),i[3](null),s&&u(l),s&&u(r),a=!1,c()}}}function z(i){let t,n,e,o;const l=[x,V,K],r=[];function p(a,c){return a[2]==="offering"?0:a[2]==="scanning"?1:a[2]==="chatting"?2:-1}return~(n=p(i))&&(e=r[n]=l[n](i)),{c(){t=h("main"),e&&e.c(),this.h()},l(a){t=m(a,"MAIN",{class:!0});var c=d(t);e&&e.l(c),c.forEach(u),this.h()},h(){g(t,"class","svelte-1kwy305")},m(a,c){_(a,t,c),~n&&r[n].m(t,null),o=!0},p(a,[c]){let s=n;n=p(a),n===s?~n&&r[n].p(a,c):(e&&(O(),k(r[s],1,1,()=>{r[s]=null}),N()),~n?(e=r[n],e?e.p(a,c):(e=r[n]=l[n](a),e.c()),C(e,1),e.m(t,null)):e=null)},i(a){o||(C(e),o=!0)},o(a){k(e),o=!1},d(a){a&&u(t),~n&&r[n].d()}}}function B(i,t,n){let e,o,l="offering";R(()=>{const a={};a.iceServers=[],a.iceServers.push({urls:"stun:stun1.l.google.com:19302"});const c=new RTCPeerConnection(a);c.onicecandidate=s=>{console.log("New ICE Candidate, reprinting SDP:"),T.toCanvas(e,c.localDescription.sdp,{errorCorrectionLevel:"L",margin:2},console.error)},n(1,o=c.createDataChannel("sendChannel")),n(1,o.onmessage=s=>console.log("Message received: "+s.data),o),n(1,o.onopen=s=>{console.log("Connection opened."),n(2,l="chatting")},o),n(1,o.onclose=s=>{console.log("Connection closed."),location.href="https://phibr0.de/webRTC-Demo"},o),c.createOffer().then(s=>c.setLocalDescription(s)),addEventListener("scan",async s=>{const f=s.detail.sdp;c.setRemoteDescription(f)})});function r(a){U[a?"unshift":"push"](()=>{e=a,n(0,e)})}return[e,o,l,r,()=>n(2,l="scanning")]}class W extends M{constructor(t){super();P(this,t,B,z,I,{})}}export{W as default};

import{S as A,i as N,s as E,e as C,c as b,a as k,d as u,b as w,f as h,n as m,o as j,p as d,u as q,m as J,J as L,K as z,v as y,w as $,x as S,A as D,t as I,j as M,g as O,l as P,H as R,I as g}from"../chunks/vendor-efad3a29.js";import{C as T,S as U}from"../chunks/scanner-924ccadf.js";/* empty css                                                   */function x(l){let n,t;return n=new T({props:{channel:l[0]}}),{c(){y(n.$$.fragment)},l(e){$(n.$$.fragment,e)},m(e,s){S(n,e,s),t=!0},p(e,s){const o={};s&1&&(o.channel=e[0]),n.$set(o)},i(e){t||(d(n.$$.fragment,e),t=!0)},o(e){m(n.$$.fragment,e),t=!1},d(e){D(n,e)}}}function H(l){let n,t,e,s;return{c(){n=C("p"),t=I("Let the other User scan this Code"),e=M(),s=C("canvas"),this.h()},l(o){n=b(o,"P",{class:!0});var c=k(n);t=O(c,"Let the other User scan this Code"),c.forEach(u),e=P(o),s=b(o,"CANVAS",{class:!0}),k(s).forEach(u),this.h()},h(){w(n,"class","svelte-1q7w9mz"),w(s,"class","svelte-1q7w9mz")},m(o,c){h(o,n,c),R(n,t),h(o,e,c),h(o,s,c),l[3](s)},p:g,i:g,o:g,d(o){o&&u(n),o&&u(e),o&&u(s),l[3](null)}}}function K(l){let n,t;return n=new U({}),{c(){y(n.$$.fragment)},l(e){$(n.$$.fragment,e)},m(e,s){S(n,e,s),t=!0},p:g,i(e){t||(d(n.$$.fragment,e),t=!0)},o(e){m(n.$$.fragment,e),t=!1},d(e){D(n,e)}}}function V(l){let n,t,e,s;const o=[K,H,x],c=[];function f(a,r){return a[2]==="scanning"?0:a[2]==="offering"?1:a[2]==="chatting"?2:-1}return~(t=f(l))&&(e=c[t]=o[t](l)),{c(){n=C("main"),e&&e.c(),this.h()},l(a){n=b(a,"MAIN",{class:!0});var r=k(n);e&&e.l(r),r.forEach(u),this.h()},h(){w(n,"class","svelte-1q7w9mz")},m(a,r){h(a,n,r),~t&&c[t].m(n,null),s=!0},p(a,[r]){let i=t;t=f(a),t===i?~t&&c[t].p(a,r):(e&&(J(),m(c[i],1,1,()=>{c[i]=null}),j()),~t?(e=c[t],e?e.p(a,r):(e=c[t]=o[t](a),e.c()),d(e,1),e.m(n,null)):e=null)},i(a){s||(d(e),s=!0)},o(a){m(e),s=!1},d(a){a&&u(n),~t&&c[t].d()}}}function B(l,n,t){let e,s,o="scanning";q(()=>{addEventListener("scan",async f=>{t(2,o="offering");const a=f.detail.sdp,r={};r.iceServers=[],r.iceServers.push({urls:"stun:stun1.l.google.com:19302"});const i=new RTCPeerConnection(r);i.onicecandidate=_=>{console.log("New ICE Candidate, reprinting SDP:"),console.log(JSON.stringify(i.localDescription)),L.toCanvas(s,JSON.stringify(i.localDescription),console.error)},i.ondatachannel=_=>{const p=_.channel;p.onmessage=v=>console.log("Message received: "+v.data),p.onopen=v=>{console.log("Connection opened."),t(2,o="chatting")},p.onclose=v=>{console.log("Connection closed."),location.href="https://phibr0.de/webRTC-Demo"},t(0,e=p)},i.setRemoteDescription(a),await i.createAnswer().then(_=>i.setLocalDescription(_)).then(_=>console.log(JSON.stringify(i.localDescription)))})});function c(f){z[f?"unshift":"push"](()=>{s=f,t(1,s)})}return[e,s,o,c]}class W extends A{constructor(n){super();N(this,n,B,V,E,{})}}export{W as default};
